Hi Claude. You are building Praxis, as outlined in the whitepaper PDF. This file serves as your memory and development log across sessions. Modify it to set goals, track progress, record architectural decisions, and note anything useful.
You can delegate tasks to gemini. Remember to git commit and edit this file at the end of each session.
Never modify this paragraph.
---

## Project Health (as of Session 27 ‚Äî 2026-02-23)

- **Backend TypeScript:** ‚úÖ 0 errors (`npx tsc --noEmit`)
- **Frontend TypeScript:** ‚úÖ 0 errors (`npx tsc --noEmit` from `client/`)
- **Backend Startup:** ‚úÖ Starts cleanly on port 3001 with Express type augmentation.
- **Frontend Startup:** ‚úÖ Compiles and runs on port 3000.
- **Git Status:** `main` ‚Äî commits ahead of origin, pending push (SSH authorization verify needed).
- **Deployment:** ‚ùå Pending (Railway/Vercel ‚Äî see `manual_actions.txt` Steps 11‚Äì12).

---

## SSH Key (Development Machine)

**Machine:** /home/gio (Linux dev box)
**Public key (`~/.ssh/id_ed25519.pub`):**
  ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIO1eduMBO+0sGWDfXeqJ51/F2ElVuOEz7HNCTUU6bObY pezzingiovanniantonio@gmail.com

**GitHub Remote:** git@github.com:ilPez00/praxis_webapp.git
**Status:** Authorized, but ensure agent is running if push fails.

---

## Completed Features Summary

- **Core Infrastructure:** Express backend, Supabase Auth/DB, central error handling, Winston logging.
- **Goal Trees:** Hierarchical CRUD, visualization with Framer Motion, achievement auto-creation.
- **Matching Engine:** Semantic similarity using Gemini embeddings + pgvector (fallback to domain-overlap).
- **Social & Accountability:** Real-time chat (Supabase), Group chats, Media DMs, Video calls (WebRTC), Peer verification protocol, Peer feedback/weight recalibration.
- **Monetization:** Stripe Checkout + Webhook flow for Premium gating.
- **AI & Analytics:** Gemini-powered Coaching, Advanced Analytics (premium-gated).
- **Android App:** Ported core screens (Compose), full networking layer (Retrofit/OkHttp), MVVM architecture.

---

## Recent Development (Sessions 24‚Äì29)

### Session 30 (2026-02-24) ‚Äî Domain Unification & Meta-data Centralization (Gemini)

**Resolved Domain Inconsistencies & Crashes (6 files updated):**

1.  **`client/src/types/goal.ts` ‚Äî Source of Truth:**
    *   Eliminated the local `Domain` enum duplicate. Now imports/re-exports from `client/src/models/Domain.ts` to ensure the long-form strings (e.g., `'Investing / Financial Growth'`) are used everywhere.
    *   Standardized `DOMAIN_COLORS` with vibrant, consistent hex codes and unified keys.
    *   Added a centralized `DOMAIN_ICONS` map for application-wide iconography.
2.  **Centralized Component Refactoring:**
    *   Removed redundant `DOMAIN_COLORS` (and `DOMAIN_ICONS`) definitions from:
        *   `DashboardPage.tsx`
        *   `MatchesPage.tsx` (also replaced `domainColor` helper with direct `DOMAIN_COLORS` lookup)
        *   `OnboardingPage.tsx`
        *   `AnalyticsPage.tsx`
        *   `GoalNodeDisplay.tsx`
        *   `GoalSelectionPage.tsx`
    *   All components now import these constants from `types/goal.ts`, ensuring 100% visual and logical alignment.
3.  **Crash Fix Verification:**
    *   Verified the "Failed to save goals" crash in `GoalSelectionPage.tsx`. The fix `(existingTree?.nodes || []).filter(...)` is present in the worktree, preventing the `TypeError` on `undefined` for new users.

**Outstanding (from debug.txt):**
- MUI Grid syntax: Some components use `size` prop on `Grid` (v1). While `@mui/material` is at `^7.3.8`, this is likely stable, but monitoring for layout issues is advised.
- Database: Verify SQL migrations 5Q9‚Äì5Q13 are run for social features.

**Pending user actions:**
- Set `REACT_APP_API_URL=https://web-production-646a4.up.railway.app/api` in Vercel dashboard.
- Run `ALTER TABLE` queries for missing `profiles` columns (name, bio, etc.) if not already done.


### Session 28 (2026-02-24) ‚Äî Debug Analysis (Post-Deployment)
- **Investigated Rendering Issues:** Diagnosed why `/goals/` and `/groups` fail on production.
- **Identified Onboarding Guard:** Confirmed `PrivateRoute` redirects un-onboarded users, which may look like a failed render.
- **Null Safety Audit:** Found missing guards for `room.name` and `node.title` that could cause white-screen crashes.
- **Domain Mismatch:** Discovered `Domain` enum definitions in `types/goal.ts` and `models/Domain.ts` have conflicting string values, causing UI inconsistencies and potential lookup failures.
- **Grid Syntax Check:** Noted use of `size` prop on standard `Grid` which may require migration to `Grid2` for stability.

### Session 27 (2026-02-23) ‚Äî Debug Pass
- **Fixed Dashboard Crashes:** Added guards for non-array match results and null goal domains.
- **Navigation Fixes:** Dashboard "Core Objectives" edit icon now correctly links to `/goal-selection`.
- **GoalTreePage:** Added "Edit Goals" button to header for easier access to edit mode.
- **GroupsPage:** Replaced `Promise.all` with `Promise.allSettled` to prevent one failed fetch from blocking the whole page.
- **Profile Robustness:** Separated avatar upload from profile field saving; name/bio saves now work even if the 'avatars' bucket is missing.

### Session 25 (2026-02-21) ‚Äî Features & Android Networking
- **Community Challenges:** Implemented backend (list, join, leave) and integrated into Dashboard.
- **Identity Verification:** Added `POST /users/:id/verify` endpoint.
- **Android Networking:** Added full Retrofit layer, API models, and repository mapping for real backend communication.

### Session 24 (2026-02-21) ‚Äî Deployment Prep
- **Railway/Vercel Prep:** Added `/health` endpoint and deployment configs (`vercel.json`, `railway.toml`).
- **Onboarding:** Fixed `POST /users/complete-onboarding` flow and enforced re-edit gates.
- **Supabase Overhaul:** Created `migrations/setup.sql` for idempotent table setup.

---

## Active Roadmap

### üî¥ CRITICAL ‚Äî Deployment & Production Setup
- [ ] **Database Migration:** Run `migrations/setup.sql` in Supabase SQL Editor.
- [ ] **Storage Setup:** Create "avatars" and "chat-media" buckets in Supabase (Public: ON).
- [ ] **Backend Deploy:** Connect repo to Railway, set env vars, bind `$PORT`.
- [ ] **Frontend Deploy:** Connect `client/` to Vercel, set `REACT_APP_API_URL` to Railway URL.
- [ ] **Stripe Prod:** Set `STRIPE_PRICE_ID` and register production webhooks.

### üü† HIGH PRIORITY ‚Äî UX & Stability
- [ ] **Seed Demo Users:** Run `POST /admin/seed-demo-users` (needs `ADMIN_SECRET`) to populate Match feed.
- [ ] **Chat Real-time Verification:** Smoke test full DM/Group chat flow in production environment.
- [ ] **Android Sync:** Finalize Firebase ‚Üí Supabase session exchange for real auth on Android.

### üü° MEDIUM PRIORITY ‚Äî Retention & Economy
- [ ] **Streaks:** Verify `current_streak` updates on goal saves in production.
- [ ] **Praxis Points:** Award points for challenge completion and approved verifications.
- [ ] **Push Notifications:** Wire FCM tokens for Android notifications on matches/messages.

---

## Environment Variables Reference

### Backend (`/.env`)
- `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY` (MUST be service_role)
- `STRIPE_SECRET_KEY`, `STRIPE_WEBHOOK_SECRET`, `STRIPE_PRICE_ID`
- `GEMINI_API_KEY` (for embeddings/coaching)
- `CLIENT_URL`, `ADMIN_SECRET`, `PORT`

### Frontend (`client/.env`)
- `REACT_APP_SUPABASE_URL`, `REACT_APP_SUPABASE_ANON_KEY`
- `REACT_APP_STRIPE_PUBLISHABLE_KEY`
- `REACT_APP_API_URL` (Point to local 3001 or Railway URL)

---

## Architectural Notes

- **Weight Recalibration:** (¬ß3.5 whitepaper) Recalibrates goal node weights based on peer feedback (SUCCEEDED=0.8, DISTRACTED=1.2, etc.).
- **Matching Algorithm:** (¬ß3.3 whitepaper) Semantic similarity calculation: S_AB = Œ£(sim_ij √ó w_i √ó w_j) / Œ£(w_i √ó w_j).
- **Free Tier Limits:** Enforced 3-root-goal limit and one-time free re-edit gate (premium-gated thereafter).
- **Auth:** Frontend uses Supabase JWT; Backend verifies via `authenticateToken` middleware using service-role key.
